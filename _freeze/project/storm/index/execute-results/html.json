{
  "hash": "968193b97f152b612151c884f63cb09e",
  "result": {
    "markdown": "---\ntitle: \"Weathering the Storm\"\ndate: \"2020-08-02\"\ncategories: [R, quant]\ndescription: \"Timeseries comparison and the impact of Covid-19 on the financial markets by sector\"\n---\n\n\n![](feature.gif){fig-alt=\"Two meerkats cuddle under an umbrella shielded from the pouring rain\"}\n\nIn 2020, Covid-19 began battering financial markets now further impacted by the war in Ukraine. Which sectors are faring best?\n\nI'll compare each sector in the S&P 500 with the overall market. Baselining each at zero as of February 19th, we'll see which were the first to recover lost ground.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(wesanderson)\nlibrary(scales, exclude = \"date_format\")\nlibrary(glue)\nlibrary(tidyquant, include.only = \"tq_get\")\nlibrary(clock)\nlibrary(usedthese)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntheme_set(theme_bw())\n\n(cols <- wes_palette(\"Moonrise2\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/theme-1.png){width=100%}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsymbols <-\n  c(\n    \"SPY\",\n    \"XLV\",\n    \"XLK\",\n    \"XLE\",\n    \"XLF\",\n    \"XLC\",\n    \"XLI\",\n    \"XLY\",\n    \"XLP\",\n    \"XLRE\",\n    \"XLU\",\n    \"XLB\"\n  )\n\nfrom <- \"2020-02-19\"\n\nfrom_formatted <- date_parse(from, format = \"%Y-%m-%d\") |> \n  date_format(format = \"%b %d, %Y\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\neod_sectors <-\n  tq_get(symbols, from = from) |>\n  mutate(\n    norm_close = adjusted / first(adjusted) - 1,\n    type = if_else(symbol == \"SPY\", \"Market\", \"Sector\"),\n    sector = case_when(\n      symbol == \"SPY\"  ~ \"S&P 500\",\n      symbol == \"XLB\"  ~ \"Materials\",\n      symbol == \"XLE\"  ~ \"Energy\",\n      symbol == \"XLU\"  ~ \"Utilities\",\n      symbol == \"XLI\"  ~ \"Industrical\",\n      symbol == \"XLRE\" ~ \"Real Estate\",\n      symbol == \"XLV\"  ~ \"Health\",\n      symbol == \"XLK\"  ~ \"Technology\",\n      symbol == \"XLF\"  ~ \"Financial\",\n      symbol == \"XLC\"  ~ \"Communication\",\n      symbol == \"XLY\"  ~ \"Consumer Discretionary\",\n      symbol == \"XLP\"  ~ \"Consumer Staples\",\n      TRUE             ~ \"Other\"\n    ), .by = symbol\n  ) |>\n  drop_na()\n```\n:::\n\n\nPerhaps not too surprising to see that Tech led the way back from Covid. But with the further impact of the situation in Ukraine, the Energy sector is now the strongest performer relative to February 2020. Comms, with all that home-working, benefited initially during the lockdown, but has faded since.\n\n\n::: {.cell}\n\n```{.r .cell-code}\neod_sectors |>\n  mutate(\n    sector = str_wrap(sector, 12),\n    sector = fct_reorder(sector, norm_close, last, .desc = TRUE)\n  ) |>\n  ggplot(aes(date, norm_close, colour = sign(norm_close))) +\n  geom_hline(yintercept = 0, linetype = \"dashed\", colour = \"grey80\") +\n  geom_line() +\n  facet_wrap(~sector) +\n  scale_colour_gradient(low = cols[2], high = cols[1]) +\n  scale_y_continuous(labels = label_percent()) +\n  labs(\n    title = \"S&P 500 Sector Impact of Covid-19 & Ukraine\",\n    subtitle = glue(\"Relative to {from_formatted}\"),\n    x = NULL, y = NULL, colour = NULL\n  ) +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1),\n        legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/visualisation-1.png){width=100%}\n:::\n:::\n\n\n## R Toolbox\n\nSummarising below the packages and functions used in this post enables me to separately create a [toolbox visualisation](/project/box) summarising the usage of packages and functions across all posts.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nused_here()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"usedthese table table-striped\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Package </th>\n   <th style=\"text-align:left;\"> Function </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> base </td>\n   <td style=\"text-align:left;\"> c[1];  library[7];  sign[1] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> clock </td>\n   <td style=\"text-align:left;\"> date_format[1];  date_parse[1] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> dplyr </td>\n   <td style=\"text-align:left;\"> case_when[1];  first[1];  if_else[1];  mutate[2] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> forcats </td>\n   <td style=\"text-align:left;\"> fct_reorder[1] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> ggplot2 </td>\n   <td style=\"text-align:left;\"> aes[1];  element_text[1];  facet_wrap[1];  geom_hline[1];  geom_line[1];  ggplot[1];  labs[1];  scale_colour_gradient[1];  scale_y_continuous[1];  theme[1];  theme_bw[1];  theme_set[1] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> glue </td>\n   <td style=\"text-align:left;\"> glue[1] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> scales </td>\n   <td style=\"text-align:left;\"> label_percent[1] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> stringr </td>\n   <td style=\"text-align:left;\"> str_wrap[1] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> tidyquant </td>\n   <td style=\"text-align:left;\"> tq_get[1] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> tidyr </td>\n   <td style=\"text-align:left;\"> drop_na[1] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> usedthese </td>\n   <td style=\"text-align:left;\"> used_here[1] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> wesanderson </td>\n   <td style=\"text-align:left;\"> wes_palette[1] </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}